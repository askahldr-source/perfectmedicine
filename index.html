<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PerfectMedicine ‚Äî Option Chain Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
:root{
  --accent:#ff7a00;
  --accent-dark:#e66800;
  --green:#17a673;
  --muted:#666;
  --sidebar-bg:#162029;
  --page-bg:#f5f6f7;
  --card-bg:#ffffff;
}
html,body{
  height:100%;margin:0;font-family:Inter,system-ui;
  background:var(--page-bg);color:#111;
}
/* Ticker */
.top-ticker{
  background:#0f1720;color:#fff;padding:6px 12px;
  display:flex;align-items:center;gap:12px;overflow:hidden;
}
.ticker-strip{white-space:nowrap;display:inline-block;animation:scroll 28s linear infinite}
.ticker-item{display:inline-block;margin-right:34px;padding:6px 8px;border-radius:4px;background:rgba(255,255,255,0.03)}
@keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* Layout */
.wrap{display:flex;height:calc(100vh - 44px)}
.sidebar{
  width:64px;background:var(--sidebar-bg);color:#fff;padding:12px 8px;
  display:flex;flex-direction:column;align-items:center;gap:14px;
  box-shadow:2px 0 4px rgba(0,0,0,0.15);
}
.sidebar .logo{font-weight:700;color:var(--accent);font-size:15px}
.sidebar .icon{
  width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;
  transition:background .3s;cursor:pointer;
}
.sidebar .icon:hover{background:rgba(255,255,255,0.08)}
.sidebar .icon.active{background:var(--accent);}

.main{flex:1;padding:12px;display:flex;flex-direction:column;gap:10px}

/* Controls */
.controls{
  background:var(--card-bg);padding:14px;border-radius:8px;display:flex;gap:10px;align-items:center;
  box-shadow:0 2px 3px rgba(0,0,0,0.05);
}
.controls select,.controls input{
  padding:8px;border:1px solid #e3e7ea;border-radius:4px
}
.controls button{
  padding:8px 12px;border-radius:5px;border:1px solid var(--accent);
  background:var(--accent);color:#fff;cursor:pointer;transition:.2s;
}
.controls button:hover{background:var(--accent-dark)}
.status-pill{background:#dff6e9;color:#0b7a4a;padding:6px 10px;border-radius:6px;font-weight:600}

/* Content */
.content{display:flex;gap:12px;flex:1;min-height:0}
.left-pane,.right-pane{
  background:var(--card-bg);border-radius:8px;padding:8px;display:flex;flex-direction:column;
  box-shadow:0 1px 3px rgba(0,0,0,0.04);
}
.left-pane{flex:1;overflow:auto}
.right-pane{width:420px;min-width:320px}

/* Table */
.table-wrap{overflow:auto;flex:1}
table.opt-table{width:100%;border-collapse:collapse;font-size:13px}
thead th{position:sticky;top:0;background:#f8fafc;padding:8px;border-bottom:1px solid #e6edf2;text-align:center}
tbody td{padding:7px;border-bottom:1px solid #f0f3f5;text-align:right}
tbody tr:nth-child(even){background:rgba(0,0,0,0.01)}
tbody tr:hover{background:#fffce0}
td.leftCol{text-align:left;font-family:monospace}
.strike-cell{background:linear-gradient(180deg,#ff9d4d,#ff8000);color:#fff;border-radius:4px;font-weight:700}
.footer-note{font-size:12px;color:var(--muted);margin-top:8px}

/* Chart */
.chart-canvas{background:linear-gradient(180deg,#fff,#fbfdff);border-radius:6px;border:1px solid #eee;padding:6px}

/* Responsive */
@media(max-width:768px){
  .content{flex-direction:column}
  .right-pane{width:100%;min-width:0}
}
</style>
</head>
<body>

<!-- Marquee -->
<div class="top-ticker">
  <div style="font-weight:700;padding:4px 8px;background:var(--accent);border-radius:6px">NSE Option Chain</div>
  <div style="flex:1;overflow:hidden">
    <div class="ticker-strip">
      <span class="ticker-item">NIFTY 25709.85 ‚ñ≤0.49%</span>
      <span class="ticker-item">TATAELXSI 1689.6 ‚ñº0.30%</span>
      <span class="ticker-item">HDFCBANK 1500 ‚ñ≤0.22%</span>
      <span class="ticker-item">RELIANCE 2540.9 ‚ñ≤0.12%</span>
      <span class="ticker-item">INFY 1621 ‚ñ≤0.25%</span>
      <span class="ticker-item">NIFTY 25709.85 ‚ñ≤0.49%</span>
    </div>
  </div>
  <div style="min-width:180px;text-align:right;color:#fff;font-size:13px">
    Spot : <strong style="color:#bff3b8">25709.85</strong>
  </div>
</div>

<div class="wrap">
  <div class="sidebar">
    <div class="logo">AiLTP</div>
    <div class="icon active" title="Dashboard">üè†</div>
    <div class="icon" title="OptionChain">üìä</div>
    <div class="icon" title="Reports">üìÅ</div>
    <div class="icon" title="Tracker">üìà</div>
    <div class="icon" title="Learn">üéì</div>
    <div style="flex:1"></div>
    <div class="icon" style="background:#0b7a4a" title="Support">‚òéÔ∏è</div>
  </div>

  <div class="main">
    <div class="controls">
      <label>Index:
        <select id="tickerSelect">
          <option value="NIFTY">NIFTY</option>
          <option value="BANKNIFTY">BANKNIFTY</option>
          <option value="FINNIFTY">FINNIFTY</option>
        </select>
      </label>
      <label>Expiry:
        <select id="expirySelect">
          <option value="all">All</option>
          <option value="2025-10-30">2025-10-30</option>
          <option value="2025-11-07">2025-11-07</option>
        </select>
      </label>
      <div style="flex:1"></div>
      <div class="status-pill" id="marketStatus">Market: Stable</div>
    </div>

    <div class="content">
      <div class="left-pane">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
          <strong>Option Chain</strong>
          <div style="flex:1"></div>
          <button id="refreshBtn">Refresh</button>
          <button id="startBtn">Auto</button>
        </div>

        <div class="table-wrap">
          <table class="opt-table">
            <thead>
              <tr>
                <th>OI Chg</th><th>OI</th><th>VOLUME</th><th>PUT</th>
                <th class="leftCol">STRIKE</th>
                <th>CALL</th><th>VOLUME</th><th>OI</th><th>OI Chg</th>
              </tr>
            </thead>
            <tbody id="optBody"></tbody>
          </table>
        </div>
        <div class="footer-note">Tip: click ‚ÄúAuto‚Äù to enable 1-min auto-refresh.</div>
      </div>

      <div class="right-pane">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <strong>Price Chart</strong>
          <small style="color:#888">5-min</small>
        </div>
        <div class="chart-canvas"><canvas id="priceChart" height="320"></canvas></div>
      </div>
    </div>
  </div>
</div>

<script>
/* --------- Data Generator --------- */
function generateSampleRows(){
  const strikes=[25450,25500,25550,25600,25650,25700,25750,25800,25850,25900];
  return strikes.map(k=>({
    strike:k,
    type:k<25700?'put':'call',
    openInterest:Math.floor(Math.random()*900000),
    volume:Math.floor(Math.random()*200000),
    oiChange:(Math.random()*10000-5000).toFixed(0)
  }));
}

/* --------- Rendering --------- */
function renderOptionTable(rows){
  const tbody=document.getElementById('optBody');
  if(!rows||!rows.length){
    tbody.innerHTML='<tr><td colspan="9" class="leftCol">No data</td></tr>';return;
  }
  tbody.innerHTML=rows.map(r=>`
  <tr>
    <td>${r.oiChange}</td>
    <td>${r.openInterest.toLocaleString()}</td>
    <td>${r.volume.toLocaleString()}</td>
    <td class="leftCol">${r.type==='put'?'Break Out':''}</td>
    <td class="strike-cell leftCol">${r.strike}</td>
    <td class="leftCol">${r.type==='call'?'Break Down':''}</td>
    <td>${r.volume.toLocaleString()}</td>
    <td>${r.openInterest.toLocaleString()}</td>
    <td>${r.oiChange}</td>
  </tr>`).join('');
}

/* --------- Chart Setup --------- */
let priceChart=null;
function initChart(){
  const ctx=document.getElementById('priceChart');
  priceChart=new Chart(ctx,{
    type:'line',
    data:{labels:[],datasets:[{
      data:[],borderColor:'#2b8cff',backgroundColor:'rgba(43,140,255,0.08)',
      tension:0.15,pointRadius:0
    }]},
    options:{responsive:true,plugins:{legend:{display:false}}}
  });
}

function updateChart(){
  const now=Date.now();
  const labels=[],data=[];
  for(let i=30;i>=0;i--){
    labels.push(new Date(now-i*5*60*1000).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}));
    data.push(25650+Math.sin(i/3)*80+(Math.random()-0.5)*40);
  }
  priceChart.data.labels=labels;
  priceChart.data.datasets[0].data=data;
  priceChart.update();
}

/* --------- Repo Fetch --------- */
async function fetchRepoJson(ticker){
  const url=`https://raw.githubusercontent.com/askahldr-source/perfectmedicine/main/data/${ticker}_all.json`;
  try{
    const resp=await fetch(url,{cache:'no-store'});
    if(!resp.ok) throw new Error('Not found');
    const j=await resp.json();
    return j.rows||j.data||[];
  }catch(e){console.warn('Fallback to sample:',e);return null;}
}

/* --------- Controller --------- */
let autoTimer=null;
async function loadAndRender(){
  const ticker=document.getElementById('tickerSelect').value;
  document.getElementById('marketStatus').textContent=`Loading ${ticker}‚Ä¶`;
  const repoData=await fetchRepoJson(ticker);
  renderOptionTable(repoData?.length?repoData:generateSampleRows());
  updateChart();
  document.getElementById('marketStatus').textContent=`${ticker} Updated at ${new Date().toLocaleTimeString()}`;
}

/* --------- Events --------- */
document.getElementById('refreshBtn').onclick=loadAndRender;
document.getElementById('startBtn').onclick=function(){
  if(autoTimer){clearInterval(autoTimer);autoTimer=null;this.textContent='Auto';}
  else{autoTimer=setInterval(loadAndRender,60*1000);this.textContent='Stop';}
};
window.addEventListener('DOMContentLoaded',()=>{initChart();loadAndRender();});
</script>
</body>
</html>
