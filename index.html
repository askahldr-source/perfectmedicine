<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Perfect Analyst - Live NIFTY Dashboard (DhanHQ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f7f7f7; margin: 0; }
        header { background: #e53935; color: #fff; text-align: center; padding: 1rem 0; font-size: 2rem; }
        .dashboard-container { max-width: 1200px; margin: 2rem auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #ccc; padding: 2rem; }
        h2 { color: #e53935; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; }
        th, td { border: 1px solid #ddd; padding: 0.75rem; text-align: center; }
        th { background: #f44336; color: #fff; font-size: 1.1rem; }
        td { background: #fff; font-weight: 500; }
        .highlight { background: #ffe082; }
        .strong { background: #c8e6c9; color: #388e3c; font-weight: bold; }
        .weak { background: #ffcdd2; color: #c62828; font-weight: bold; }
        .reversal { background: #b3e5fc; color: #0277bd; font-weight: bold; }
        .footer-note { margin-top: 2rem; font-size: 1rem; color: #888; text-align: center; }
        @media (max-width: 900px) {
            .dashboard-container { padding: 1rem; }
            table, th, td { font-size: 0.95rem; }
        }
        @media (max-width: 600px) {
            table, th, td { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <header>
        Perfect Analyst - Market Dashboard (DhanHQ Live)
    </header>
    <div class="dashboard-container">
        <h2>NIFTY Option Chain (Live from DhanHQ)</h2>
        <table id="optionTable">
            <thead>
                <tr>
                    <th>Strike</th>
                    <th>Spot</th>
                    <th>OI</th>
                    <th>OI Chg</th>
                    <th>Volume</th>
                    <th class="reversal">Reversal</th>
                    <th>Delta</th>
                    <th>Strength</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be inserted dynamically -->
            </tbody>
        </table>
        <div class="footer-note">
            © 2025 Perfect Analyst | Live Data | Powered by DhanHQ
        </div>
    </div>
    <script>
        // Your DhanHQ Option Chain API endpoint and token
        const API_URL = "https://api.dhan.co/options/option-chain";
        const TOKEN = "YOUR_DHANHQ_API_KEY"; // <-- Replace with your API key

        // Get correct scripCode for NIFTY from DhanHQ docs or dashboard!
        const payload = {
            "exchangeSegment": "NSE", // For NIFTY
            "scripCode": "NIFTY" // Replace with correct scripCode if needed
        };

        // Example reversal logic – you can change based on your strategy
        function calculateReversal(dataRow) {
            if (dataRow.changeInOpenInterest > 50000) return 'Break Out';
            else if (dataRow.changeInOpenInterest < -10000) return 'Break Down';
            else return 'Neutral';
        }

        function updateTable(optionData) {
            const tbody = document.querySelector('#optionTable tbody');
            tbody.innerHTML = '';
            optionData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.strikePrice}</td>
                    <td>${row.spotPrice || '-'}</td>
                    <td>${row.openInterest}</td>
                    <td class="${row.changeInOpenInterest > 0 ? 'strong' : 'weak'}">${row.changeInOpenInterest}</td>
                    <td>${row.volume}</td>
                    <td class="reversal">${calculateReversal(row)}</td>
                    <td>${row.delta || '-'}</td>
                    <td class="${row.strength && row.strength > 50 ? 'strong' : 'weak'}">${row.strength ? row.strength + '%' : '-'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Fetch live data and update every 1 minute
        async function fetchOptionData() {
            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "access-token": TOKEN
                    },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                // Adjust this based on DhanHQ's response structure
                // Example: data.optionChainDetails
                const optionRows = data.optionChainDetails || [];
                updateTable(optionRows);
            } catch (e) {
                console.error('Error fetching data:', e);
            }
        }

        fetchOptionData();
        setInterval(fetchOptionData, 60000); // update every 1 min
    </script>
</body>
</html>
